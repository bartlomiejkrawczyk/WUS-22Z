---
# TODO: Load all machines from azure, or not :)
# - hosts: localhost
#   tasks:
#     - name: Echo virtual machines
#       ansible.builtin.shell:
#         cmd: echo {{ item.name }}
#       loop: "{{ virtual_machine }}"
    
#     - name: Echo deployments per virtual machines
#       ansible.builtin.shell:
#         cmd: echo {{ item.0.name }} {{ item.1.type }}
#       with_subelements:
#         - "{{ virtual_machine }}"
#         - deploy

- hosts: 
  - all
  - localhost
  become: true
  pre_tasks:
    - name: Echo virtual machines
      ansible.builtin.shell:
        cmd: echo {{ item.backend_port }} {{ abc }}
      loop: "{{ parameters }}"

    - name: Update repository index
      apt:
        update_cache: yes
    
    - name: Upgrade packages
      apt:
        upgrade: dist

- hosts: 
  - db_master
  - db_slave
  become: true
  roles:
    - db_base

- hosts:
  - db_master
  become: true
  roles:
    - db_master

- hosts:
  - db_slave
  become: true
  roles:
    - db_slave

- hosts: 
  - backend
  - backend_replicaset
  become: true
  roles:
    - backend_base

- hosts: 
  - backend
  become: true
  roles:
    - backend

- hosts: 
  - backend_replicaset
  become: true
  roles:
    - backend_replicaset
  
- hosts: 
  - nginx
  become: true
  roles:
    - nginx

- hosts: 
  - frontend
  become: true
  roles:
    - frontend